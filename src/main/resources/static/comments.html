<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Forum - Discussion Board</title>
    <link rel="stylesheet" href="/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <main>
      <nav>
        <a href="/">Home</a>
        <a href="/search.html">Search</a>
      </nav>
      <h2>Discussion Board</h2>
      <form id="commentForm">
        <h3 style="margin-top: 0">Add to the Discussion</h3>
        <label for="commentInput">Your message:</label>
        <input
          id="commentInput"
          name="text"
          placeholder="Share your thoughts..."
        />
        <button type="submit">Post Message</button>
      </form>
      <h3>Recent Messages</h3>
      <ul id="commentsList"></ul>
      <a href="/" class="back-link">‚Üê Back to Home</a>
    </main>
    <script src="/client.js"></script>
    <script>
      async function loadComments() {
        const r = await fetch("/api/comments");
        const data = await r.json();
        const ul = document.getElementById("commentsList");
        ul.innerHTML = "";
        data.forEach((c) => {
          const li = document.createElement("li");
          li.innerHTML = c.text; // VULNERABLE: innerHTML from stored data
          ul.appendChild(li);
        });
      }

      document
        .getElementById("commentForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const text = document.getElementById("commentInput").value;
          await fetch("/api/comments", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text }),
          });
          document.getElementById("commentInput").value = "";
          loadComments();
        });

      loadComments();
    </script>
  </body>
</html>
